rules:
- id: CA3077
  languages: [csharp]
  severity: WARNING
  metadata: 
    cwe: 'CWE-611: Improper Restriction of XML External Entity Reference'
    references: 
      - https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca3077
    category: security
  message: |
    When designing an API derived from XMLDocument and XMLTextReader, be mindful of DtdProcessing. 
    Using insecure DTDProcessing instances when referencing or resolving external entity sources or setting insecure values in the XML may lead to information disclosure.
    Catch and process all XmlTextReader exceptions properly to avoid path information disclosure .
    Use XmlSecureResolverinstead of XmlResolver to restrict the resources the XmlTextReader can access.
  patterns:
    - pattern-inside: |
        using System.Xml;
        using System.Xml.Xsl;
        ...
    - pattern-either:
      - patterns:
          - pattern-inside: |
              class $C
              {
                  ...
                  void $P()
                  {
                      ...
                      XslCompiledTransform $XSLT = new XslCompiledTransform();
                      ...
                      var $SET = XsltSettings.TrustedXslt;
                      ...
                      var $RES = new XmlUrlResolver();
                      ...
                  }
              }
          - pattern: |
              $XSLT.Load("...", $SET, $RES);
      - patterns:
          - pattern-inside: |
              class $C
              {
                  ...
                  private $T $P(XsltSettings $SET)
                  {
                      try
                      {
                          ...
                          XslCompiledTransform $XSLT = new XslCompiledTransform();
                          ...
                          var $RES = new XmlUrlResolver();
                          ...
                      }
                      catch {...}
                      finally {...}
                  }
              }
          - pattern: |
              xslCompiledTransform.Load("...", $SET, $RES);